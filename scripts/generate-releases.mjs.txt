import fs from 'fs';
import path from 'path';

const folder = 'content/releases';
const files = fs.readdirSync(folder);

let releases = [];

// 各JSONファイルを読み込み
for (const file of files) {
  if (file.endsWith('.json')) {
    const filePath = path.join(folder, file);
    const data = JSON.parse(fs.readFileSync(filePath, 'utf-8'));
    // releases.jsで使う構造に整形
    releases.push({
      id: data.id,
      title: data.title,
      date: data.date,
      excerpt: data.excerpt,
      img: data.img,
      link: `detail.html?id=${data.id}`,
      content: data.content,
      tags: data.tags
    });
  }
}

// 日付でソート（新しい順）
releases.sort((a, b) => new Date(b.date) - new Date(a.date));

// releases.js の内容を生成
const output = `var releasesData = ${JSON.stringify(releases, null, 2)};`;

// ファイル書き込み
fs.writeFileSync('releases.js', output);

console.log('releases.js generated with', releases.length, 'items.');
